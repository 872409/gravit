<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="style/main.css">
    <title>JavaScript ColorPicker | I am Fredric</title>
</head>
<body>
<style>
    body {
        background: blue;
    }
    p {
        margin: 0;
        padding: 0;
    }
    .test  {
        width: 400px;
        margin: auto;
    }
    #color_palette {
        border: #000 1px solid;
    }
    #color_selector {
        border: #000 1px solid;
    }
    #color_info {
        float: right;
        position: relative;
        display: inline-block;
        width: 80px;
        height: 255px;
        overflow: hidden;
    }
    #color_choosen {

        width: 80px;
        height: 80px;
        background: #fff;
    }
    .color_codes  {
        margin: 10px 0;
    }
    .name  {
        display: inline-block;
        width: 20px;
    }
    .input_span  {
        display: inline-block;
        width: 50px;
    }
    .input_box  {
        width: 50px;
        font-size: 10px;
    }
</style>
<div class="test">
    <canvas id="color_palette" width="255" height="255"></canvas>
    <canvas id="color_selector" width="40" height="255"></canvas>
    <div id="color_info">
        <section id="color_choosen"></section>
        <section class="color_codes">
            <p><span class="name">H</span><span class="input_span"><input type="text" class="input_box" id="col_hue"></span></p>
            <p><span class="name">S</span><span class="input_span"><input type="text" class="input_box" id="col_sat"></span></p>
            <p><span class="name">L</span><span class="input_span"><input type="text" class="input_box" id="col_lig"></span></p>
        </section>
        <section class="color_codes">
            <p><span class="name">R</span><span class="input_span"><input type="text" class="input_box" id="col_red"></span></p>
            <p><span class="name">G</span><span class="input_span"><input type="text" class="input_box" id="col_green"></span></p>
            <p><span class="name">B</span><span class="input_span"><input type="text" class="input_box" id="col_blue"></span></p>
        </section>
        <section class="color_codes">
            <p><span class="name">#</span><span class="input_span"><input type="text" class="input_box" id="col_hex"></span></p>
        </section>
    </div>
</div>
<script>
/**
 * Putting the input boxes for the color numeric values
 * into an variable.
 */
var col_hue = document.getElementById("col_hue");
var col_sat = document.getElementById("col_sat");
var col_lig = document.getElementById("col_lig");
var col_red = document.getElementById("col_red");
var col_green = document.getElementById("col_green");
var col_blue = document.getElementById("col_blue");
var col_hex = document.getElementById("col_hex");
var col_choosen = document.getElementById("color_choosen");
/**
 * Variables to store where in the canvas we last clicked
 * @type {Number}
 */
var pal_click_x = 0;
var pal_click_y = 0;
var sel_click_y = 0;
/**
 * Gets the color palette canvas and asigns it to an variable
 * @type {<canvas>}
 */
var pal_canvas = document.getElementById("color_palette");
var pal_ctx = pal_canvas.getContext("2d");
/**
 * We get the color selector canvas and asigns it to an variable
 * @type {<canvas>}
 */
var sel_canvas = document.getElementById("color_selector");
var sel_ctx = sel_canvas.getContext("2d");
/**
 * Variables for the colors Hue, Saturation, lightnes
 * @type {Number}
 */
var h = 0;
var s;
var l;
var saturation = 0;
var lightnes = 0;
var red;
var green;
var blue;
/**
 * Starting up the application
 */
init();
/**
 * The method for starting the application
 */
function init(){
    palette();
    selector();
}
/**
 * The function that sets up the color palette
 * @return {void}
 */
function palette(){
    pal_ctx.clearRect(0, 0, 255, 255);
    for(var y = 0; y < 255; y++){
        for(var x = 0; x < 255; x++){
            s = (x/255)*100;
            l = 100 - ((y/255)*100);
            draw_palette(x, y);
        }
    }
}
/**
 * The function that sets up the color selector bar
 */
function selector(){
    sel_ctx.clearRect(0, 0 , 255, 40);
    for(var y = 0; y < 255; y++){
        for(var x = 0; x < 40; x++){
            draw_selector(x, y);
        }
    }
}
/**
 * Now lets draw the color palette
 * @param {Number} x The x position
 * @param {Number} y The y position
 */
function draw_palette(x, y){
    var color = new hsl2rgb(h, s, l);
    pal_ctx.fillStyle = "rgb(" + color['r'] + ", " + color['g'] + ", " + color['b'] + ")";
    pal_ctx.fillRect(x,y,1,1);
}
/**
 * And let us draw the color selector bar
 * @param {Number} x The x position
 * @param {Number} y The y position
 */
function draw_selector(x, y){
    var c = Math.round((360/255)*y);
    var color = new hsl2rgb(c, 100, 50);
    sel_ctx.fillStyle = "rgb(" + color['r'] + ", " + color['g'] + ", " + color['b'] + ")";
    sel_ctx.fillRect(x,y,1,1);
}
/**
 * Function that converts HSL to RGB
 * @param {Number} h The hue value
 * @param {Number} s The sat value
 * @param {Number} l The lightness value
 * @return {Array} rgb
 */
function hsl2rgb(h, s, l) {
    var m1, m2, hue;
    var r, g, b;
    s /=100;
    l /= 100;
    if (s === 0)
        r = g = b = (l * 255);
    else {
        if (l <= 0.5)
            m2 = l * (s + 1);
        else
            m2 = l + s - l * s;
        m1 = l * 2 - m2;
        hue = h / 360;
        r = HueToRgb(m1, m2, hue + 1/3);
        g = HueToRgb(m1, m2, hue);
        b = HueToRgb(m1, m2, hue - 1/3);
    }
    return {r: Math.round(r), g: Math.round(g), b: Math.round(b)};
}
function HueToRgb(m1, m2, hue) {
    var v;
    if (hue < 0)
        hue += 1;
    else if (hue > 1)
        hue -= 1;
    if (6 * hue < 1)
        v = m1 + (m2 - m1) * hue * 6;
    else if (2 * hue < 1)
        v = m2;
    else if (3 * hue < 2)
        v = m1 + (m2 - m1) * (2/3 - hue) * 6;
    else
        v = m1;
    return 255 * v;
}
/**
 * Functions that converts rgb to Hex
 */
function componentToHex(col) {
    var hex = col.toString(16);
    return hex.length == 1 ? "0" + hex : hex;
}
function rgbToHex(r, g, b) {
    return componentToHex(r) + componentToHex(g) + componentToHex(b);
}
/**
 * Draws the palette marker
 */
function draw_palette_marker(){
    pal_ctx.beginPath();
    pal_ctx.arc(pal_click_x-2, pal_click_y-2, 4, 0, Math.PI*2, true);
    pal_ctx.closePath();
    pal_ctx.stroke();
}
/**
 * Updates all color data
 */
function update_colors(){
    var c = hsl2rgb(h, saturation, lightnes);
    col_choosen.style.background = "rgb(" + c['r'] + ", " + c['g'] + ", " + c['b'] + ")";
    col_hue.value = h;
    col_sat.value = Math.round(saturation);
    col_lig.value = Math.round(lightnes);
    col_red.value = c['r'];
    col_green.value = c['g'];
    col_blue.value = c['b'];
    col_hex.value = rgbToHex(c['r'], c['g'], c['b']);
}
/**
 * Function that draws a marker where color is selected
 */
function draw_selector_marker(){
    selector();
    sel_ctx.fillStyle = "#000";
    sel_ctx.fillRect(0, sel_click_y,40,1);
}
/**
 * Updates the application
 */
function update(){
    palette();
    draw_palette_marker();
    selector();
    draw_selector_marker();
    update_colors();
}
/**
 **************************************************************
 **************** AND NOW, LET's DO THE EVENTS ****************
 **************************************************************
 */
/**
 * If hue bar is clicked we would like to update
 * The value of the hue, the position of the marker
 * and the color palette + all the coloring values
 */
sel_canvas.addEventListener("click", function(e){
    h = Math.round((e.offsetY*360)/255);
    sel_click_y = e.offsetY;
    pal_ctx.clearRect(0, 0 , 255, 255);
    palette();
    draw_palette_marker();
    draw_selector_marker();
    update_colors();
});
/**
 * If palette clicked, move the marker to where it's clicked
 * and updates all the color data
 */
pal_canvas.addEventListener("click", function(e){
    pal_click_x = e.offsetX;
    pal_click_y = e.offsetY;
    saturation = (pal_click_x/255)*100;
    lightnes = 100 - ((pal_click_y/255)*100);
    palette();
    draw_palette_marker();
    update_colors();
});
/**
 * This event lets us set the hue value by using the input box
 */
col_hue.addEventListener("keyup", function(){
    if(Number(col_hue.value)){
        h = col_hue.value;
        sel_click_y = ((h*255)/360);
        update();
    }
});
/**
 * This event lets us set the saturation value by using the input box
 */
col_sat.addEventListener("keyup", function(){
    if (Number(col_sat.value)) {
        saturation = col_sat.value;
        pal_click_x = (saturation*255)/100;
        update();
    }
});
/**
 * This event lets us set the lightnes value by using the input box
 */
col_lig.addEventListener("keyup", function(){
    if (Number(col_lig.value)) {
        lightnes = col_lig.value;
        pal_click_y = 255 - ((lightnes*255)/100);
        update();
    }
});
</script>
</body>
</html>